<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · AllocArrays.jl</title><meta name="title" content="Home · AllocArrays.jl"/><meta property="og:title" content="Home · AllocArrays.jl"/><meta property="twitter:title" content="Home · AllocArrays.jl"/><meta name="description" content="Documentation for AllocArrays.jl."/><meta property="og:description" content="Documentation for AllocArrays.jl."/><meta property="twitter:description" content="Documentation for AllocArrays.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>AllocArrays.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Public-API"><span>Public API</span></a></li></ul></li><li><a class="tocitem" href="examples/">Examples</a></li><li><a class="tocitem" href="interface/">Allocator interface</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ericphanson/AllocArrays.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ericphanson/AllocArrays.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AllocArrays"><a class="docs-heading-anchor" href="#AllocArrays">AllocArrays</a><a id="AllocArrays-1"></a><a class="docs-heading-anchor-permalink" href="#AllocArrays" title="Permalink"></a></h1><p>API Documentation for <a href="https://github.com/ericphanson/AllocArrays.jl">AllocArrays</a>. See also the README at that link for more examples and notes.</p><h2 id="Public-API"><a class="docs-heading-anchor" href="#Public-API">Public API</a><a id="Public-API-1"></a><a class="docs-heading-anchor-permalink" href="#Public-API" title="Permalink"></a></h2><h3 id="Array-types"><a class="docs-heading-anchor" href="#Array-types">Array types</a><a id="Array-types-1"></a><a class="docs-heading-anchor-permalink" href="#Array-types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.AllocArray" href="#AllocArrays.AllocArray"><code>AllocArrays.AllocArray</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct AllocArray{T,N} &lt;: DenseArray{T,N}
    arr::UnsafeArray{T,N}
    gcref::Any
end

AllocArray(arr::AbstractArray)</code></pre><p>Wrapper type which forwards most array methods to the inner array <code>arr</code>, but dispatches <code>similar</code> to special allocation methods.</p><p>The inner array <code>arr</code> is always represented as an <code>UnsafeArray</code>, but the field <code>gcref</code> may hold a materialized <code>AbstractArray</code> corresponding to the same data, which is held to preserve a reference to the data to prevent GC. This field is never accessed or used, so the <code>::Any</code> type does not affect type stability of code using AllocArrays.</p><p>Use the constructor <code>AllocArray(arr)</code> to construct an <code>AllocArray</code>. Note that <code>arr</code> must be able to be represented as an <code>UnsafeArray</code>, meaning it must be a bits-type and have a pointer. To support <code>UnitRange</code> and similar, <code>collect</code> it first.</p><p>Typically this constructor is only used at the entrypoint of a larger set of code which is expected to use <code>similar</code> based on this input for further allocations. When inside a <code>with_allocator</code> block, <code>similar</code> can be dispatched to a (dynamically-scoped) bump allocator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/AllocArray.jl#L6-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.CheckedAllocArray" href="#AllocArrays.CheckedAllocArray"><code>AllocArrays.CheckedAllocArray</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CheckedAllocArray(arr::AbstractArray)</code></pre><p>&quot;Slow but safe&quot; version of <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>.</p><p>Keeps track of whether or not its memory is valid. All accesses to the array first check if the memory is still valid, and throw an <code>InvalidMemoryException</code> if not.</p><p>If the array has memory allocated via a <a href="#AllocArrays.BumperAllocator"><code>BumperAllocator</code></a>, when the <code>BumperAllocator</code> is reset via <a href="#AllocArrays.reset!"><code>reset!</code></a>, its memory will be marked invalid.</p><p>Uses locks to ensure concurrency safety to avoid races between deallocating memory on one task (with <code>reset!</code>) while accessing it on another task (e.g. <code>getindex</code>). However, this array is as unsafe as any other to write and read its contents simultaneously with multiple tasks. (i.e. locks are used only to ensure validity of the memory backing the array when the memory is accessed, not to remove data races when using the array as usual).</p><p>See also: <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/CheckedAllocArray.jl#L18-L39">source</a></section></article><h3 id="Allocators"><a class="docs-heading-anchor" href="#Allocators">Allocators</a><a id="Allocators-1"></a><a class="docs-heading-anchor-permalink" href="#Allocators" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.BumperAllocator" href="#AllocArrays.BumperAllocator"><code>AllocArrays.BumperAllocator</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BumperAllocator(b::AllocBuffer)</code></pre><p>Use with <a href="#AllocArrays.with_allocator"><code>with_allocator</code></a> to dispatch <code>similar</code> calls for <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>s and <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>s to allocate using the buffer <code>b</code>, an <code>AllocBuffer</code> provided by Bumper.jl.</p><p>Uses a lock to serialize allocations to the buffer <code>b</code>, which should allow safe concurrent usage.</p><p>Used with <a href="#AllocArrays.reset!"><code>reset!</code></a> to deallocate. Note it is not safe to deallocate while another task may be allocating, except with <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>s which will error appropriately.</p><p>See also: <a href="#AllocArrays.UncheckedBumperAllocator"><code>UncheckedBumperAllocator</code></a>.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">using AllocArrays, Bumper

b = BumperAllocator(AllocBuffer(2^24)) # 16 MiB
input = AllocArray([1,2,3])
c = Channel(Inf)
with_allocator(b) do
    # ...code with may be multithreaded but which must not escape or return newly-allocated AllocArrays...
    @sync for i = 1:10
        Threads.@spawn put!(c, sum(input .+ i))
    end
    reset!(b) # called outside of threaded region
    close(c)
end
sum(collect(c))

# output
225</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L160-L198">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.with_allocator" href="#AllocArrays.with_allocator"><code>AllocArrays.with_allocator</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">with_allocator(f, allocator)</code></pre><p>Run <code>f</code> within a dynamic scope such that <code>similar</code> calls to <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>s and <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>s dispatch to allocator <code>allocator</code>.</p><p>Used with allocators <a href="#AllocArrays.DefaultAllocator"><code>DefaultAllocator</code></a>, <a href="#AllocArrays.BumperAllocator"><code>BumperAllocator</code></a>, and <a href="#AllocArrays.UncheckedBumperAllocator"><code>UncheckedBumperAllocator</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L292-L301">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.reset!" href="#AllocArrays.reset!"><code>AllocArrays.reset!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset!(B::UncheckedBumperAllocator)</code></pre><p>Resets the <code>UncheckedBumperAllocator</code>, deallocating all of the arrays created by it.</p><p>This must only be used if those arrays will not be accessed again.</p><p>It is not safe to deallocate on one task while using the allocator to allocate on another task. Therefore this should only be called outside of threaded regions of code.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L118-L129">source</a></section><section><div><pre><code class="language-julia hljs">reset!(b::BumperAllocator)</code></pre><p>Resets the <code>BumperAllocator</code>, deallocating all of the arrays created by it.</p><p>This must only be used if those arrays will not be accessed again. However, <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>s allocated by this allocator will be marked invalid, causing future accesses to them to error, as a safety feature. <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>s have no such safety feature, and access to them after <code>reset!</code> is unsafe.</p><p>It is also not safe to deallocate on one task while using the allocator to allocate on another task. Therefore this should only be called outside of threaded regions of code.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L261-L276">source</a></section></article><p>We also provide an unsafe option.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.UncheckedBumperAllocator" href="#AllocArrays.UncheckedBumperAllocator"><code>AllocArrays.UncheckedBumperAllocator</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">UncheckedBumperAllocator(b::AllocBuffer)</code></pre><p>Use with <a href="#AllocArrays.with_allocator"><code>with_allocator</code></a> to dispatch <code>similar</code> calls for <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>s to allocate using the buffer <code>b</code>, an <code>AllocBuffer</code> provided by Bumper.jl.</p><p>Does not support <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>.</p><p>This provides a naive &amp; direct interface to allocating on the buffer with no safety checks or locks.</p><p>This is unsafe to use if multiple tasks may be allocating simultaneously, and using <a href="#AllocArrays.BumperAllocator"><code>BumperAllocator</code></a> is recommended in general.</p><p>Used with <a href="#AllocArrays.reset!"><code>reset!</code></a> to deallocate.</p><p>See also: <a href="#AllocArrays.BumperAllocator"><code>BumperAllocator</code></a>.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">using AllocArrays, Bumper

input = AllocArray([1,2,3])
b = UncheckedBumperAllocator(AllocBuffer(2^24)) # 16 MiB
with_allocator(b) do
    # ...code with must not allocate AllocArrays on multiple tasks via `similar` nor escape or return newly-allocated AllocArrays...
    ret = sum(input .* 2)
    reset!(b)
    return ret
end

# output
12</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L70-L106">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AllocArrays.DefaultAllocator" href="#AllocArrays.DefaultAllocator"><code>AllocArrays.DefaultAllocator</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DefaultAllocator()</code></pre><p>Represents the default Julia allocator.</p><p>Used to dispatch <code>similar</code> calls for <a href="#AllocArrays.AllocArray"><code>AllocArray</code></a>s and <a href="#AllocArrays.CheckedAllocArray"><code>CheckedAllocArray</code></a>s to allocate using the the default Julia allocator.</p><p>This allocator is used by default if another one is not used via <a href="#AllocArrays.with_allocator"><code>with_allocator</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/AllocArrays.jl/blob/6faaf78e5c12d5647e3d6e46e044586094a64397/src/alloc_interface.jl#L26-L37">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Tuesday 18 March 2025 23:48">Tuesday 18 March 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
